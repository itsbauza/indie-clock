# Enable MQTT plugin
mqtt.listeners.tcp.default = 1883
mqtt.allow_anonymous = false
mqtt.default_user = ${RABBITMQ_BACKEND_USER}
mqtt.default_pass = ${RABBITMQ_BACKEND_PASSWORD}

# WebSocket MQTT disabled (requires SSL certificates)

# Enable management plugin
management.load_definitions = /etc/rabbitmq/definitions.json

# Logging
log.console = true
log.console.level = info

# Memory and disk limits - optimized for production
vm_memory_high_watermark.relative = 0.4  # Lower threshold to prevent issues
disk_free_limit.relative = 2.0

# Memory optimization settings
vm_memory_high_watermark_paging_ratio = 0.5
vm_memory_calculation_strategy = rss  # More accurate memory reporting

# Queue settings to prevent memory buildup
queue_master_locator = min-masters

# Connection and channel limits to prevent resource exhaustion
connection_max = 1000
channel_max = 2047

# Security settings
auth_failure_delay = 5000  # 5 second delay after auth failure
auth_mechanisms.1 = PLAIN

# MQTT Security and rate limiting
mqtt.exchange = amq.topic
mqtt.vhost = /
mqtt.tcp_listen_options.backlog = 4096
mqtt.tcp_listen_options.nodelay = true

# Rate limiting to prevent abuse
mqtt.prefetch = 10

# TCP keepalive settings
tcp_listen_options.keepalive = true
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0